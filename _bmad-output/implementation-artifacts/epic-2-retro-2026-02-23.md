# Epic 2 Partial Retrospective - Game Collection Infrastructure

**Epic:** #8 - Game Collection Infrastructure  
**Sprint:** Sprint 2 (2026-02-10 to 2026-02-23)  
**Retrospective Date:** 2026-02-23  
**Type:** Partial Sprint Retrospective (Epic in progress — 4/8 stories complete)  
**Team:** Paul (Solo Developer)  
**Facilitator:** Bob (Scrum Master)

---

## Executive Summary

Sprint 2 ended with **6/7 committed items delivered** (86% completion rate). The core domain and persistence layers are fully operational. Story 2.5 (GetGames) was not completed — the sprint ran out of time after Story 2.4 merged on the final day. Epic 2 remains in progress; Sprint 3 will complete it before Epic 3 begins.

**Highlights:**
- ✅ 4/4 committed stories completed (2.1–2.4)
- ✅ 2/2 Sonar fixes delivered on Sprint Day 1
- ✅ ADR-003 (IndexedDB Strategy) created proactively during implementation
- ✅ ADR-009 and ADR-010 formalized during this retrospective
- ✅ Value Objects + React Hook Form integration: elegant, no custom resolver needed
- ⚠️ Story 2.5 carry-over: sprint ended immediately after Story 2.4 merge
- ⚠️ Stories 2.6–2.8: stretch goals, not started
- ❌ Architecture diagram (Mermaid): deferred from Epic 1, still pending

---

## Sprint 2 Completion Status

### Committed Items (6/7 done — 86%)

| # | Item | Issue | PR | Merged | Notes |
|---|------|-------|----|----|-------|
| Sonar | Use globalThis instead of window | #62 | #71 | 2026-02-10 (Day 1) | Priority: low |
| Sonar | Use top-level await instead of async IIFE | #63 | #72 | 2026-02-10 (Day 1) | Priority: critical |
| 2.1 | Game Entity with Value Objects | #9 | #81 | 2026-02-11 (Day 2) | XS - Foundation |
| 2.2 | IndexedDB Persistence Layer | #10 | #100 | 2026-02-17 (Day 6) | L - Most complex |
| 2.3 | AddGame Use Case | #11 | #105 | 2026-02-17 (Day 6) | S - Built on 2.2 |
| 2.4 | GameForm UI Component | #12 | #109 | 2026-02-23 (Day 10) | L - UI complexity |
| 2.5 | GetGames Use Case | #13 | — | ❌ Not started | **Carry-over to Sprint 3** |

### Stretch Goals (0/3 — not started, expected)

| # | Item | Issue | Status |
|---|------|-------|--------|
| 2.6 | UpdateGame Use Case | #14 | Carry-over |
| 2.7 | DeleteGame Use Case | #15 | Carry-over |
| 2.8 | NotFound / Error Handling | #16 | Carry-over |

### Discovered During Sprint

| Item | Issue | Priority | Status |
|------|-------|----------|--------|
| Sonar: IndexedDB promise rejections use Error objects | #106 | High | Open — backlog Sprint 3 |

---

## Sprint Timeline Analysis

```
Feb 10 (Day 1)  : ✅ Sonar #62 + #63 — PR #71, #72
Feb 11 (Day 2)  : ✅ Story 2.1 Domain Entity — PR #81
Feb 12 → 16     :    Story 2.2 IndexedDB [working]
Feb 17 (Day 6)  : ✅ Story 2.2 IndexedDB — PR #100
                  ✅ Story 2.3 AddGame Use Case — PR #105
Feb 18 → 23     :    Story 2.4 GameForm UI
Feb 23 (Day 10) : ✅ Story 2.4 GameForm — PR #109
                  ❌ Story 2.5 GetGames — not started
```

**Key observation:** Story 2.4 merged on the last day of the sprint, leaving no time for Story 2.5 (estimated S = 0.5 day).

---

## What Went Well

### 1. Sonar Fixes on Day 1

Both committed Sonar issues were resolved on the first day of the sprint. This demonstrates good discipline — closing debt before opening new features sets a clean foundation for the sprint.

### 2. Story 2.1 Done on Day 2

The domain entity (Game + 6 Value Objects) completed in 2 days. As the foundation for all subsequent stories, completing it quickly unblocked the rest of the sprint.

### 3. Value Objects + React Hook Form — No Custom Resolver Needed

The integration of Value Objects as validators in React Hook Form `validate` functions was elegant and friction-free. Initial expectations were that a custom RHF resolver would be required. Instead, VO factory methods (`GameTitle.create()`, `Platform.create()`, etc.) mapped directly to RHF's validation API. This validates the architecture: domain logic remains in the domain layer while UI benefits from it with zero coupling.

### 4. ADR-003 Created Proactively

An IndexedDB Storage Strategy ADR was created during implementation (not mandated by the sprint). This reflects a healthy habit of documenting decisions as they are made, rather than retroactively.

### 5. Shared Infrastructure Pattern

IndexedDB was placed in `src/shared/infrastructure/` (not in `collection/`) from the start. This anticipates future bounded contexts reusing the same storage engine — good DRY thinking. Similarly, new UI components created for Story 2.4 were placed in `src/shared/ui/components/` rather than collection-specific directories, following the same principle.

### 6. GameForm Component Follows Pattern

The `GameForm/GameForm.tsx` component correctly follows the `<ComponentName>/<ComponentName>.tsx` folder pattern established as a goal in Epic 1.

---

## Challenges

### 1. Story 2.4 UI Complexity Underestimated

The UI component work (GameForm) took the full remaining sprint budget. The complexity was not in the business logic — it was in **creating missing UI components** (SelectField, DateField, TextAreaField) and **styling them to meet accessibility standards**. These components were not in the existing shelter-ui toolkit, requiring them to be built from scratch.

**Root cause:** Story sizing focused on business logic complexity; UI component creation was not explicitly accounted for.

**Consequence:** These components now live in `shared/ui/components/` and should be migrated to the shelter-ui design system to prevent duplication in future sprints.

### 2. Story 2.5 Not Completed — Sprint Ended on Story 2.4

Story 2.5 (GetGames, estimated S = 0.5 day) was never started. The sprint ended the moment Story 2.4 was merged. The pattern of stories 2.2 + 2.3 landing on Day 6 and 2.4 taking until Day 10 left no capacity.

**Not a failure** — the sprint delivered all committed stories except the last one. But the sequencing left no buffer.

### 3. `.copilot/` Implementation Notes Fell Out of Sync

The `.copilot/story-2.2.md` notes documented a "direct class binding" DI approach that was subsequently replaced with Symbol-based identifiers. The notes were not updated to reflect the final implementation. This caused a brief incorrect assumption during the retrospective.

**Lesson learned:** Implementation notes in `.copilot/` are valuable but should be treated as drafts, not authoritative documentation. ADRs remain the source of truth.

### 4. AI Agent Auto-PR (Copilot Experiment)

During Story 2.2 exploration, an AI agent (GitHub Copilot online) automatically opened a pull request. It was immediately closed — it was an unintended artifact of experimentation. Copilot CLI has since addressed this behavior. No action required unless it recurs.

---

## Deep Dive — Story Analysis

### Story 2.1: Game Entity with Value Objects ✅
**Issue #9 | PR #81 | Merged 2026-02-11**

**Key decisions made:**
- `Result.unwrap()` adopted over `Result.getValue()` to avoid collision with VO getter naming
- Getters on Value Objects are type-specific (`getTitle()`, `getFormat()`) not generic (`getValue()`)
- `Game.create()` accepts primitives, not Value Objects — ergonomic for UI consumption
- `Platform` and `Format` use validated strings (not enums) for future database-driven flexibility
- `Status` remains an enum — controlled business states
- Game getters return primitives (not Value Objects) — encapsulation of domain internals
- `equals()` and `toString()` removed from all VOs (YAGNI)

**Outcome:** 115 tests passing, clean domain layer, RHF integration validated.

---

### Story 2.2: IndexedDB Persistence Layer ✅
**Issue #10 | PR #100 | Merged 2026-02-17**

**Key decisions made:**
- IndexedDB infrastructure placed in `shared/` (not `collection/`) — reusable across contexts
- `RepositoryInterface<T>` generic created in shared domain — prevents CRUD duplication
- DTOs as classes with readonly primitives (not interfaces)
- Symbol.for() service identifiers established as convention → formalized in ADR-009
- `import type` vs `import` distinction: `import type` is erased at runtime — caused test failures with fake-indexeddb; regular imports required for runtime class references

**Bugs fixed:** Constructor parameters were unused (hardcoded constants instead); `import type` caused fake-indexeddb timeouts.

**Outcome:** 128 tests passing, full IndexedDB integration with fake-indexeddb.

---

### Story 2.3: AddGame Use Case ✅
**Issue #11 | PR #105 | Merged 2026-02-17**

**Key decisions made:**
- Validation exists **only at domain level** — Application layer does not re-validate (anti-pattern: triple validation)
- Application errors encapsulate domain errors in metadata — clear error hierarchy
- `AddGameDTO` uses `Date | null` for `purchaseDate` (same-runtime boundary) → formalized in ADR-010
- CQRS noted as a future consideration (use case could return the created Game ID)

**Note:** Story 2.3 and 2.2 merged on the same day — once the infrastructure was in place, the use case layer was quick to build.

---

### Story 2.4: GameForm UI Component ✅
**Issue #12 | PR #109 | Merged 2026-02-23**

**Key decisions made:**
- Missing UI components (SelectField, DateField, TextAreaField) created in `shared/ui/components/`
- `aria-errormessage` used for error messages (aligned with shelter-ui `InputField` pattern)
- `required` native HTML attribute used over `aria-required` on form controls
- Value Objects used directly in RHF `validate` functions — no custom resolver
- RHF wrapper components (`formField`) isolate the RHF API from the domain

**UI components created (not yet in shelter-ui):**
- `SelectField` — accessible select with label, error, and helper text
- `DateField` — date input with accessible label and error
- `TextAreaField` — multiline text input with character count

**Outcome:** Full GameForm UI with accessibility compliance. Sprint ended immediately after merge.

---

## Architectural Decisions Made This Sprint

| ADR | Title | Status |
|-----|-------|--------|
| ADR-003 | IndexedDB Storage Strategy | ✅ Created during implementation |
| ADR-009 | Symbol-based Service Identifiers for DI | ✅ Created during this retrospective |
| ADR-010 | Date Type Conventions in Application DTOs | ✅ Created during this retrospective |

---

## Epic 1 Action Items — Follow-through

| Action Item | Status | Notes |
|------------|--------|-------|
| ADR: No TypeScript Decorators | ✅ ADR-007 created | Done in Epic 1 sprint end |
| ADR: Result Pattern Usage Convention | ✅ ADR-008 created | Done in Epic 1 sprint end |
| ADR: PWA Architecture Pattern | ✅ ADR-006 exists | Pre-existing |
| Enrich PWA documentation | ✅ `docs/infrastructure/pwa.md` | Done |
| Apply `<Name>/<Name>.tsx` component pattern | ⚠️ Partial | `GameForm/GameForm.tsx` ✅ but `pages/Home.tsx` and `pages/AddGame.tsx` ❌ |
| Architecture diagram (Mermaid) | ❌ Not done | Deferred — P3 |

---

## Action Items for Sprint 3

### P0 — Blockers

| # | Action Item | Owner | Type |
|---|------------|-------|------|
| A1 | **Story 2.5 GetGames** — carry-over, blocks Epic 3 | Dev | Story |
| A2 | **UX session with Sally** — wireframe app with accessibility notions | SM + PO | Ceremony |

### P1 — High Priority

| # | Action Item | Owner | Type |
|---|------------|-------|------|
| A3 | Story 2.6 UpdateGame | Dev | Story |
| A4 | Story 2.7 DeleteGame | Dev | Story |
| A5 | Sonar #106 — IndexedDB promise rejections use Error objects | Dev | Tech debt |
| A6 | ADR: Page/Layout ownership in multi-context Clean Architecture | Architect | ADR |

*Note: ADR-011 (page ownership) requires the UX session with Sally first — the layout architecture must align with the UI design decisions.*

### P2 — Medium Priority

| # | Action Item | Owner | Type |
|---|------------|-------|------|
| A7 | Story 2.8 NotFound / Error Handling | Dev | Story |
| A8 | Pages `Home.tsx` + `AddGame.tsx` → migrate to `<Name>/<Name>.tsx` | Dev | Tech debt |
| A9 | shelter-ui migration — story-per-component, sized individually | Dev + PO | Tech debt |

### P3 — Low Priority (Backlog)

| # | Action Item | Owner | Type |
|---|------------|-------|------|
| A10 | PWA DI refactoring — align Symbol pattern with Collection context | Dev | Tech debt |
| A11 | Architecture diagram (Mermaid) — deferred from Epic 1 | Architect | Documentation |

### WATCH — Monitor, no action needed now

| # | Item | Trigger for action |
|---|------|--------------------|
| W1 | AI agent auto-PR convention | If Copilot auto-opens PRs again |

---

## Sprint 3 — Proposed Scope

Epic 2 should be fully completed in Sprint 3 before Epic 3 (Search, Filter & Sort) begins. Recommended sequencing:

```
Day 1    : Story 2.5 GetGames (S = 0.5d)
Day 1-2  : UX session with Sally — wireframe + accessibility notions
Day 2-3  : Story 2.6 UpdateGame (M = ~1d)
Day 3    : Story 2.7 DeleteGame + Sonar #106 (S + S = 1d)
Day 4    : ADR-011 Page ownership + Story 2.8 NotFound (S + S = 1d)
Day 4-5  : shelter-ui component stories (sizing required)
Day 5    : Pages pattern fix + buffer
```

**Epic 3 can begin** once Story 2.5 is done and Sally's wireframe is available.

---

## Notes on Working with AI Agents

This sprint was the first to use AI coding agents (GitHub Copilot) intensively for implementation. Key observations:

- AI agents excel at: boilerplate generation, pattern application, test writing
- AI agents require: human validation of architectural decisions, pattern corrections on first use
- The `.copilot/` session notes are valuable for capturing implementation context but should not be treated as authoritative documentation — ADRs remain the source of truth
- Copilot CLI has improved agent boundary behavior compared to the GitHub online agent

---

*Retrospective facilitated by Bob (Scrum Master) — BMAD Framework*  
*Generated: 2026-02-23*
